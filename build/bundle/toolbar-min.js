KISSY.add("apebook/bundle/toolbar",["jquery","lodash","./events"],function(n,a,e,t){function o(n,a,e,t){var o=n.children(a).size();0>e&&(e=Math.max(0,o+1+e)),n.append(t),o>e&&n.children(a).eq(e).before(n.children(a).last())}function s(n){n.preventDefault()}function d(n){var a=c("<div>",{"class":"dropdown-menu",html:'<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>'});if(p.isString(n))a.append(n);else{var e=p.map(n,function(n){return p.isArray(n)?n:[n]});p.each(e,function(n){var e=c("<div>",{"class":"buttons"}),t="size-"+n.length;p.each(n,function(n){n=p.defaults(n||{},{text:"",className:"",onClick:s});var a=c("<button>",{"class":"button "+t+" "+n.className,text:n.text});a.click(n.onClick),e.append(a)}),a.append(e)})}return a}function l(n){n=p.defaults(n||{},{label:"",icon:"",text:"",position:"left",className:"",onClick:s,dropdown:null,index:null}),f.push(n),i(n)}function i(n){var a,e=c(".book-header"),t=e.find("h1"),s="pull-"+n.position,l=c("<a>",{"class":"btn",text:n.text?" "+n.text:"","aria-label":n.label,href:"#"});if(l.click(n.onClick),n.icon&&c("<i>",{"class":n.icon}).prependTo(l),n.dropdown){var i=c("<div>",{"class":"dropdown "+s+" "+n.className});l.addClass("toggle-dropdown"),i.append(l);var r=d(n.dropdown);r.addClass("dropdown-"+("right"==n.position?"left":"right")),i.append(r),a=i}else l.addClass(s),l.addClass(n.className),a=l;a.addClass("js-toolbar-action"),p.isNumber(n.index)&&n.index>=0?o(e,".btn, .dropdown, h1",n.index,a):a.insertBefore(t)}function r(){c(".js-toolbar-action").remove(),p.each(f,i)}var c=a("jquery"),p=a("lodash"),u=a("./events"),f=[];u.bind("page.change",function(){r()}),t.exports={createButton:l}});