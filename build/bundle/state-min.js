KISSY.add("apebook/bundle/state",["jquery","url","path"],function(a,t,e,o){function s(){var a=n(".J_CountStar");if(a.length){var t=a.attr("data-user"),e=a.attr("data-repo"),o=t+":"+e;if(sessionStorage){var s=sessionStorage.getItem(o);s&&(a.find("span").html(s),a.data("count",!0))}a.data("count")||n.ajax({url:"https://api.github.com/repos/"+t+"/"+e,dataType:"jsonp",jsonp:"callback",success:function(t){var e=t.data,s=e.stargazers_count||0;a.find("span").html(s),sessionStorage&&sessionStorage.setItem(o,s)}})}var r=n(".J_CountView");if(r.length){var i=r.attr("data-api");if(sessionStorage){var l=sessionStorage.getItem(i);l&&(r.find("span").html(l),r.data("count",!0))}r.data("count")||n.ajax({url:i,dataType:"jsonp",jsonp:"callback",success:function(a){a.success&&(a=a.result,r.find("span").html(a.view),sessionStorage&&sessionStorage.setItem(i,a.view))}})}}var n=t("jquery"),r=t("url"),i=t("path"),l={};l.update=function(a){var t=n(a.find(".book"));l.$book=t,l.level=t.data("level"),l.basePath=t.data("basepath"),l.innerLanguage=t.data("innerlanguage"),l.revision=t.data("revision"),l.filepath=t.data("filepath"),l.chapterTitle=t.data("chapter-title"),l.root=r.resolve(location.protocol+"//"+location.host,i.dirname(i.resolve(location.pathname.replace(/\/$/,"/index.html"),l.basePath))).replace(/\/?$/,"/"),l.bookRoot=l.innerLanguage?r.resolve(l.root,".."):l.root,s(),n("pre code").each(function(a,t){hljs&&hljs.highlightBlock(t)})},l.update(n),o.exports=l});