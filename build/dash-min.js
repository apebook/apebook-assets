KISSY.add("apebook/dash",["node","io","kg/notification/1.0.0/","apebook/history/view","kg/xtemplate/4.3.0/runtime"],function(t,e,n,o){var r,a,i,s,u=e("node"),p=e("io"),l=e("kg/notification/1.0.0/"),c=e("apebook/history/view"),d=e("kg/xtemplate/4.3.0/runtime");r=function(e){return e=function(){var e=u,n=e.all,o=n("#J_UploaderBtn");return o.length?void t.use("kg/uploader/3.0.5/index,kg/uploader/3.0.5/themes/singleImageUploader/index",function(t,e,o){var r="kg/uploader/3.0.5/plugins/auth/auth,kg/uploader/3.0.5/plugins/urlsInput/urlsInput,kg/uploader/3.0.5/plugins/proBars/proBars,kg/uploader/3.0.5/plugins/filedrop/filedrop,kg/uploader/3.0.5/plugins/preview/preview";t.use(r,function(t,r,a,i,s,u){var p=new e("#J_UploaderBtn",{action:"/api/book/cover",data:{id:n(".J_BookId").val()}});p.theme(new o({queueTarget:"#J_UploaderQueue"})),p.plug(new r({maxSize:3e3})).plug(new i).plug(new u),p.restore()})}):!1}}(),a=function(t){var e=u.all,n=p,o=l;return t=function(){var t=new o,r=e(".J_UpdateBook"),a=!1;r.on("click",function(){return a?!1:(t.notify({boxCls:"warning",mPartMsg:"更新中请稍等五分钟"}),r.text("更新书籍中..."),a=!0,void n.post("/api/book/sync",{id:e(".J_BookId").val()}).then(function(e){var n=e[0];t.notify(n.success?{boxCls:"success",mPartMsg:n.msg||"更新成功"}:{boxCls:"warn",mPartMsg:n.msg}),a=!1,r.text("更新书籍")}))});var i=e(".J_OpenBook");i.on("click",function(){var o=i.attr("data-status");n.post("/api/book/post",{id:e(".J_BookId").val(),openStatus:o}).then(function(n){var r=n[0];return r.success?(t.notify({boxCls:"success",mPartMsg:"状态设置成功"}),i.text("open"===o&&"隐藏书籍"||"公开书籍"),e(".J_OpenStatus").text("open"===o&&"隐藏书籍"||"公开书籍"),void i.attr("open"===o&&"hide"||"open")):(t.notify({boxCls:"warn",mPartMsg:r.msg}),!1)})})}}(),i=function(t){var e=p,n=c,o=d,r=u.all;return t=function(){function t(){e.jsonp(i,{start:u}).then(function(t){var e=t[0];if(e.success){var r=new o(n).render({historys:e.result});a.append(r),u+=p,e.result.length<p?s.hide():s.css("display","block")}})}var a=r(".J_HistoryWrapper");if(!a.length)return!1;var i=a.attr("data-api");if(!i)return!1;var s=r(".J_HistoryMore"),u=0,p=10;t(),s.on("click",function(e){e.halt(),t()})}}(),s=function(t){var e=r;e();var n=a;n();var o=i;return o(),t}(),o.exports=s});