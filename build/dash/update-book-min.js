KISSY.add("apebook/dash/update-book",["node","io","kg/notification/1.0.0/"],function(o,t,n,s){var a=t("node").all,e=t("io"),i=t("kg/notification/1.0.0/");s.exports=function(){var o=new i,t=a(".J_UpdateBook"),n=!1;t.on("click",function(){return n?!1:(o.notify({boxCls:"warning",mPartMsg:"更新中请稍等五分钟"}),t.text("更新图书中..."),n=!0,void new e({type:"post",url:"/api/book/sync",timeout:6e3,data:{id:a(".J_BookId").val()},success:function(t){var s=t[0];o.notify(s.success?{boxCls:"success",mPartMsg:s.msg||"更新成功"}:{boxCls:"warn",mPartMsg:s.msg}),n=!1,setTimeout(function(){location.reload()},1e3)},dataType:"json"}))});var s=a(".J_OpenBook");s.on("click",function(){var t=s.attr("data-status");io.post("/api/book/post",{id:a(".J_BookId").val(),openStatus:t}).then(function(n){var e=n[0];return e.success?(o.notify({boxCls:"success",mPartMsg:"状态设置成功"}),s.text("open"===t&&"隐藏图书"||"公开图书"),a(".J_OpenStatus").text("open"===t&&"隐藏图书"||"公开图书"),void s.attr("open"===t&&"hide"||"open")):(o.notify({boxCls:"warn",mPartMsg:e.msg}),!1)})})}});